<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <title>G1 Not√≠cias - √öltimas</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, Helvetica, sans-serif;
        }
        
        html,
        body {
            width: 100%;
            height: 100%;
            background: #000;
            color: #fff;
            overflow: hidden;
        }
        
        #feed {
            position: relative;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            transition: background-image 0.8s ease-in-out, opacity 0.4s ease-in-out;
            display: flex;
            align-items: flex-end;
            justify-content: center;
        }
        /* ü™∂ Logo */
        
        .logo {
            position: absolute;
            top: 20px;
            right: 25px;
            width: 130px;
            z-index: 16;
            filter: drop-shadow(0 0 6px rgba(0, 0, 0, .8));
        }
        /* ü™∂ Painel aumentado em 0,5 pol (~48px) */
        
        .overlay {
            position: absolute;
            bottom: 0;
            width: 100%;
            background: rgba(0, 0, 0, .75);
            padding: 108px 70px 98px;
            /* antes: 60px 70px 50px ‚Üí +48px total */
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            z-index: 10;
            overflow: hidden;
            backdrop-filter: blur(2px);
        }
        /* üîª Barra superior */
        
        .title-bar {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 12px;
            background: linear-gradient(90deg, #c4170c, #e53935);
            z-index: 11;
            box-shadow: 0 -2px 8px rgba(0, 0, 0, .4);
        }
        /* üî† T√≠tulo ampliado proporcionalmente */
        
        .title {
            font-size: 2.3em;
            /* antes: 2em */
            font-weight: bold;
            text-shadow: 0 0 15px rgba(0, 0, 0, .8);
            margin-bottom: 20px;
            /* antes: 15px */
            padding: 0 20px;
        }
        /* üìù Descri√ß√£o ampliada */
        
        .description {
            font-size: 1.35em;
            /* antes: 1.2em */
            line-height: 1.7;
            /* antes: 1.6 */
            padding: 0 20px;
            word-break: break-word;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        /* üì± Responsivo */
        
        @media(max-width:768px) {
            .title {
                font-size: 1.8em;
            }
            .description {
                font-size: 1.1em;
                padding: 0 12px;
            }
            .overlay {
                padding: 45px 24px 35px;
                /* aumento proporcional no mobile */
            }
            .logo {
                width: 100px;
                top: 15px;
                right: 15px;
            }
        }
    </style>
</head>

<body>
    <div id="feed">
        <img class="logo" src="https://s2-g1.glbimg.com/9yYCBhtSsy23W0pNwYgEil7i_eM=/144x0/http://i.s3.glbimg.com/v1/AUTH_afd7a7aa13da4265ba6d93a18f8aa19e/pox/g1.png" alt="G1 Logo">
        <div class="overlay">
            <div class="title-bar"></div>
            <div class="title" id="title"></div>
            <div class="description" id="description"></div>
        </div>
    </div>

    <script>
        (function() {
            const FEED_URL = "https://g1.globo.com/dynamo/brasil/rss2.xml";
            const PROXY = "https://api.allorigins.win/raw?url="; // ideal: trocar por proxy pr√≥prio com cache
            const PLACEHOLDER = "https://via.placeholder.com/1920x1080?text=Not√≠cia+sem+imagem";

            const feedEl = document.getElementById("feed");
            const titleEl = document.getElementById("title");
            const descEl = document.getElementById("description");

            // mostra placeholder imediato para n√£o ficar tela preta
            function showPlaceholder() {
                feedEl.style.backgroundImage = `url('${PLACEHOLDER}')`;
                titleEl.textContent = "Carregando √∫ltima not√≠cia...";
                descEl.textContent = "";
            }
            showPlaceholder();

            function cleanText(s) {
                if (!s) return "";
                try {
                    const t = s.replace(/<[^>]*>/g, "");
                    const ta = document.createElement("textarea");
                    ta.innerHTML = t;
                    return (ta.value || "").trim();
                } catch (e) {
                    return String(s).trim();
                }
            }

            function extractImageFromItem(item) {
                try {
                    const media = item.getElementsByTagName("media:content")[0] || item.getElementsByTagName("content")[0];
                    if (media && media.getAttribute && media.getAttribute("url")) return media.getAttribute("url");
                    const enclosure = item.getElementsByTagName("enclosure")[0];
                    if (enclosure && enclosure.getAttribute && enclosure.getAttribute("url")) return enclosure.getAttribute("url");
                    const descEl = item.getElementsByTagName("description")[0];
                    const desc = descEl && descEl.textContent ? descEl.textContent : (descEl && descEl.text ? descEl.text : "");
                    if (desc) {
                        const m = desc.match(/https?:\/\/[^"'<> ]+\.(jpg|jpeg|png|gif)(\?[^ "'<>]*)?/i);
                        if (m) return m[0];
                    }
                } catch (e) { /* ignore */ }
                return null;
            }

            function parseFeedXml(xmlText) {
                const parser = new DOMParser();
                const doc = parser.parseFromString(xmlText, "application/xml");
                const items = doc.getElementsByTagName("item");
                const arr = [];
                for (let i = 0; i < items.length; i++) {
                    const it = items[i];
                    const tEl = it.getElementsByTagName("title")[0];
                    const dEl = it.getElementsByTagName("description")[0];
                    const title = tEl && tEl.textContent ? cleanText(tEl.textContent) : "";
                    const desc = dEl && dEl.textContent ? cleanText(dEl.textContent) : "";
                    const image = extractImageFromItem(it);
                    arr.push({
                        title,
                        description: desc,
                        image
                    });
                }
                return arr;
            }

            // fetch com timeout usando AbortController
            function fetchWithTimeout(url, timeout = 3000) {
                const controller = new AbortController();
                const id = setTimeout(() => controller.abort(), timeout);
                return fetch(url, {
                        signal: controller.signal
                    })
                    .then(resp => {
                        clearTimeout(id);
                        if (!resp.ok) throw new Error("HTTP " + resp.status);
                        return resp.text();
                    });
            }

            // preload imagem com timeout (retorna true/false)
            function preloadImageWithTimeout(url, timeout = 3000) {
                return new Promise((resolve) => {
                    if (!url) return resolve(false);
                    const img = new Image();
                    let done = false;
                    const timer = setTimeout(() => {
                        if (!done) {
                            done = true;
                            resolve(false);
                        }
                    }, timeout);
                    img.onload = function() {
                        if (!done) {
                            done = true;
                            clearTimeout(timer);
                            resolve(true);
                        }
                    };
                    img.onerror = function() {
                        if (!done) {
                            done = true;
                            clearTimeout(timer);
                            resolve(false);
                        }
                    };
                    img.src = url;
                });
            }

            // atualiza UI sem bloquear
            function show(item) {
                // efeito suave
                feedEl.style.opacity = "0.8";
                setTimeout(() => {
                    feedEl.style.backgroundImage = `url('${item.image || PLACEHOLDER}')`;
                    titleEl.textContent = item.title || "";
                    descEl.textContent = item.description || "";
                    feedEl.style.opacity = "1";
                }, 80);
            }

            // L√≥gica principal: tenta carregar feed, com fallback r√°pido
            (async function loadFeed() {
                try {
                    const xmlText = await fetchWithTimeout(PROXY + encodeURIComponent(FEED_URL), 3000);
                    const news = parseFeedXml(xmlText).filter(n => !!n.title);
                    if (!news || news.length === 0) {
                        titleEl.textContent = "Nenhuma not√≠cia com imagem encontrada";
                        descEl.textContent = "Tente novamente mais tarde.";
                        return;
                    }

                    // pega pr√≥ximo √≠ndice (rotaciona)
                    const lastIndex = parseInt(localStorage.getItem("lastNewsIndex") || "0", 10);
                    const idx = (lastIndex + 1) % news.length;

                    // tenta pr√©-carregar imagem com timeout curto
                    const ok = await preloadImageWithTimeout(news[idx].image, 3000);
                    show(ok ? news[idx] : {
                        title: news[idx].title,
                        description: news[idx].description,
                        image: PLACEHOLDER
                    });
                    localStorage.setItem("lastNewsIndex", idx);
                } catch (err) {
                    // fallback r√°pido: placeholder + mensagem
                    titleEl.textContent = "Erro ao carregar not√≠cias";
                    descEl.textContent = "Verifique conex√£o ou tente novamente mais tarde.";
                    feedEl.style.backgroundImage = `url('${PLACEHOLDER}')`;
                    console.warn("Feed load error:", err);
                }
            })();

        })();
    </script>

</body>

</html>